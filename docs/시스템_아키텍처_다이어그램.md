# 🏗️ Android XR 테스트 앱 - 시스템 아키텍처 다이어그램

## 📋 전체 시스템 개요

이 문서는 Android XR 테스트 앱의 시스템 아키텍처를 시각적으로 설명합니다.

---

## 🏛️ 전체 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           ANDROID XR 테스트 앱                                    │
│                        (AR Glass Q&A System)                                    │
│                                                                                 │
│  📱 minSdk: 34 | 🎯 targetSdk: 36 | 🔧 Kotlin: 2.0.21                           │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                             ┌──────────┴──────────┐
                             │   MainActivity.kt   │
                             │  🚀 앱 진입점        │
                             │  - XR 모드 감지      │
                             │  - 권한 관리        │
                             │  - UI 상태 관리     │
                             └──────────┬──────────┘
                                        │
        ┌───────────────────────────────┼───────────────────────────────┐
        │                               │                               │
 ┌──────▼──────┐               ┌───────▼───────┐               ┌───────▼───────┐
 │ 🎨 UI Layer │               │ 📷 Camera     │               │ 🤖 AI/Vision │
 │ (Compose)   │               │    Layer      │               │    Layer      │
 │             │               │ (Camera2 API) │               │ (OpenAI GPT)  │
 └─────────────┘               └───────────────┘               └───────────────┘
        │                               │                               │
        ├─ CrosshairOverlay            ├─ Camera2Manager               ├─ VisionIntegration
        ├─ TextInputField              ├─ ImageReader                  ├─ RealtimeVisionClient  
        ├─ VoiceSettingsDialog         ├─ YUV→JPEG 변환                ├─ VisionAnalyzer
        └─ Material3 Components        └─ 실시간 프레임 캡처            └─ WebSocketManager
                                                │                               │
                                       ┌───────▼───────┐               ┌───────▼───────┐
                                       │ 🖼️ Image      │               │ 🌐 OpenAI     │
                                       │   Processing  │               │    Services   │
                                       │               │               │               │
                                       │ • 30fps 캡처  │               │ • GPT-4o      │
                                       │ • 품질 최적화  │               │ • GPT-4V      │
                                       │ • 메모리 관리  │               │ • Whisper-1   │
                                       └───────────────┘               └───────┬───────┘
                                                                              │
                                    ┌──────────────────────────────────────────┴──────┐
                                    │                                                 │
                           ┌───────▼────────┐                              ┌───────▼────────┐
                           │ 🎤 Audio       │                              │ 👁️ Vision      │
                           │   Processing   │                              │   Analysis     │
                           │                │                              │                │
                           │ • Speech→Text  │                              │ • Image→Text   │
                           │ • Text→Speech  │                              │ • Object Detection│
                           │ • 24kHz PCM16  │                              │ • Scene Analysis│
                           │ • Korean/EN    │                              │ • Color Analysis│
                           └────────────────┘                              └────────────────┘
```

---

## 🔄 데이터 플로우 아키텍처

### **단계별 데이터 흐름**

```
[1] 사용자 입력
     │
     ├── 🎤 음성 입력 ─────────────┐
     ├── 📝 텍스트 입력 ──────────┤
     └── 📸 버튼 입력 ───────────┤
                                │
                                ▼
[2] 입력 처리 시스템            │
     │                         │
     ├── VoiceManager ─────────┘
     ├── TextInputField        
     └── Button Click Handler   
                                │
                                ▼
[3] AI 처리 요청                │
     │                         │
     ├── 텍스트 쿼리 ──────────┤
     └── 이미지 캡처 ─────────┤
                                │
                                ▼
[4] OpenAI API 호출            │
     │                         │
     ├── Realtime API ────────┤
     │   (WebSocket)           │
     └── Vision API ──────────┤
         (REST HTTP)           │
                                │
                                ▼
[5] AI 응답 처리               │
     │                         │
     ├── 텍스트 응답 ─────────┤
     ├── 음성 데이터 ────────┤
     └── 분석 결과 ──────────┤
                                │
                                ▼
[6] 출력 시스템                │
     │                         │
     ├── UI 텍스트 표시 ──────┘
     ├── TTS 음성 재생
     └── 상태 표시
```

---

## 🏗️ 클래스 구조 다이어그램

### **핵심 클래스 간의 관계**

```
MainActivity
    │
    ├── 🎯 VisionIntegration
    │    │
    │    ├── 🤖 RealtimeVisionClient
    │    │    │
    │    │    ├── 🌐 WebSocketManager
    │    │    ├── 🔊 AudioProcessor
    │    │    └── 📡 WebSocket Connection
    │    │
    │    ├── 👁️ VisionAnalyzer  
    │    │    │
    │    │    ├── 🌍 OkHttpClient
    │    │    ├── 🖼️ Image Processing
    │    │    └── 📊 Analysis Cache
    │    │
    │    └── 📋 State Management
    │         │
    │         ├── StateFlow<IntegrationState>
    │         ├── StateFlow<String?> (responses)
    │         └── StateFlow<Boolean> (processing)
    │
    ├── 📷 Camera2Manager
    │    │
    │    ├── 🎥 CameraDevice
    │    ├── 🖼️ ImageReader
    │    ├── 🎬 CameraCaptureSession
    │    └── 🧵 BackgroundHandler
    │
    ├── 🎤 VoiceManager
    │    │
    │    ├── 📢 TextToSpeech
    │    ├── 🎙️ SpeechRecognizer  
    │    └── 🔊 AudioManager
    │
    └── 🎨 UI Components
         │
         ├── 🎯 CrosshairOverlay
         ├── 📝 TextInputField
         ├── ⚙️ VoiceSettingsDialog
         └── 🎮 FloatingActionButtons
```

---

## 🔧 기술 스택 레이어 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                        🎨 PRESENTATION LAYER                    │
├─────────────────────────────────────────────────────────────────┤
│ • Jetpack Compose 2025.04.01                                   │
│ • Material Design 3                                            │  
│ • Android XR Compose                                           │
│ • StateFlow & Compose State                                    │
└─────────────────────────────────────────────────────────────────┘
                                │
┌─────────────────────────────────────────────────────────────────┐
│                        🏢 BUSINESS LOGIC LAYER                 │
├─────────────────────────────────────────────────────────────────┤
│ • VisionIntegration (통합 관리)                                  │
│ • State Management (상태 관리)                                  │
│ • Error Handling (오류 처리)                                    │
│ • Lifecycle Management (생명주기)                               │
└─────────────────────────────────────────────────────────────────┘
                                │
┌─────────────────────────────────────────────────────────────────┐
│                        🔌 SERVICE LAYER                        │
├─────────────────────────────────────────────────────────────────┤
│ • RealtimeVisionClient (OpenAI 실시간)                          │
│ • VisionAnalyzer (GPT-4V 분석)                                  │
│ • VoiceManager (음성 처리)                                      │
│ • Camera2Manager (카메라 제어)                                   │
└─────────────────────────────────────────────────────────────────┘
                                │
┌─────────────────────────────────────────────────────────────────┐
│                        🌐 NETWORK LAYER                        │
├─────────────────────────────────────────────────────────────────┤
│ • WebSocketManager (실시간 통신)                                │
│ • OkHttpClient (HTTP 요청)                                     │
│ • Retrofit2 (REST API)                                        │
│ • JSON Processing (데이터 변환)                                │
└─────────────────────────────────────────────────────────────────┘
                                │
┌─────────────────────────────────────────────────────────────────┐
│                        🔧 PLATFORM LAYER                       │
├─────────────────────────────────────────────────────────────────┤
│ • Android SDK 36                                               │
│ • Kotlin Coroutines                                           │
│ • Camera2 API                                                 │
│ • AudioManager                                                │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🎯 상태 관리 다이어그램

### **앱 생명주기와 상태 전환**

```
    [앱 시작]
        │
        ▼
   ┌─────────┐
   │ LOADING │ ← 초기화 중
   └────┬────┘
        │ 권한 승인 & 초기화 완료
        ▼
   ┌─────────┐
   │  IDLE   │ ← 대기 상태
   └────┬────┘
        │ API 연결 시작
        ▼
   ┌─────────┐
   │CONNECTING│ ← OpenAI 연결 중
   └────┬────┘
        │ WebSocket 연결 완료
        ▼
   ┌─────────┐
   │  READY  │ ← 사용 준비 완료
   └────┬────┘
        │ 사용자 음성 감지
        ▼
   ┌─────────┐
   │LISTENING│ ← 음성 인식 중
   └────┬────┘
        │ 음성→텍스트 완료
        ▼
   ┌─────────┐
   │PROCESSING│ ← AI 처리 중
   └────┬────┘
        │ AI 응답 생성
        ▼
   ┌─────────┐
   │RESPONDING│ ← 응답 출력 중
   └────┬────┘
        │ 응답 완료
        ▼
   ┌─────────┐
   │  READY  │ ← 다음 입력 대기
   └─────────┘
        │
        └── (반복)
```

---

## 📊 성능 및 리소스 다이어그램

### **메모리 사용 패턴**

```
메모리 사용량 (MB)
 300 ┤                    
 250 ┤     📸 이미지 처리 피크
 200 ┤  ┌──┐                 ┌──┐
 150 ┤──┘  └─────────────────┘  └──
 100 ┤  일반 실행 상태               
  50 ┤                              
   0 └─────────────────────────────────
     앱    카메라   AI     대기   다음
     시작  캡처    처리    상태   요청

기준선: 120MB (기본 실행)
피크: 280MB (이미지 처리 시)
평균: 160MB (일반 사용)
```

### **네트워크 사용 패턴**

```
데이터 사용량
┌─────────────┬─────────────┬─────────────┐
│ 연결 유지   │ 이미지 전송 │ 음성 스트림 │
│ (WebSocket) │ (Vision)    │ (Realtime)  │
├─────────────┼─────────────┼─────────────┤
│ 1-2 KB/min  │ 20-50 KB    │ 5-10 KB/sec │
│ (지속)      │ (요청당)    │ (활성화시)  │
└─────────────┴─────────────┴─────────────┘
```

---

## 🛡️ 보안 및 권한 다이어그램

### **권한 요청 흐름**

```
[앱 시작] → [권한 체크] → [권한 요청 다이얼로그]
                │              │
                │              ├── 승인 → [기능 활성화]
                │              └── 거부 → [제한된 기능]
                │
[이미 승인됨] ──┘
                │
                ▼
        [필요한 권한들]
        ├── 📷 CAMERA (필수)
        ├── 🎤 RECORD_AUDIO (권장)  
        ├── 🌐 INTERNET (필수)
        └── 📶 ACCESS_NETWORK_STATE (필수)
```

### **데이터 보안 처리**

```
[사용자 데이터] → [앱 내 처리] → [외부 전송]
       │               │              │
       │               ├── 이미지 압축 ├── HTTPS 암호화
       │               ├── 음성 인코딩 ├── API 키 인증
       └── 로컬 임시저장 ├── 텍스트 처리 └── TLS 1.3 보안
           (자동 삭제)   │
                        └── 개인정보 필터링
```

---

## 🚀 배포 및 확장성 다이어그램

### **배포 구조**

```
┌─────────────────────────────────────────────────────────────┐
│                        🏗️ 개발 환경                         │
├─────────────────────────────────────────────────────────────┤
│ • Android Studio (IDE)                                      │
│ • Gradle Build System                                      │
│ • Kotlin Compiler                                          │
│ • Version Catalogs (의존성)                                │
└─────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                        📦 빌드 아티팩트                      │
├─────────────────────────────────────────────────────────────┤
│ • APK (Debug/Release)                                       │
│ • AAB (Android App Bundle)                                  │
│ • ProGuard 최적화                                           │
│ • Signing Configuration                                     │
└─────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                        🎯 배포 대상                         │
├─────────────────────────────────────────────────────────────┤
│ • Android 14+ 스마트폰                                      │
│ • AR 글래스 디바이스                                        │
│ • Android XR 에뮬레이터                                     │
│ • 개발용 AVD                                               │
└─────────────────────────────────────────────────────────────┘
```

### **확장 가능성 구조**

```
현재 시스템
     │
     ├── 🌍 다국어 확장
     │    ├── 중국어 지원
     │    ├── 일본어 지원
     │    └── 스페인어 지원
     │
     ├── 🎯 도메인 특화
     │    ├── 의료용 AI 모델
     │    ├── 교육용 콘텐츠
     │    └── 산업용 매뉴얼
     │
     ├── 🔌 하드웨어 통합
     │    ├── Meta Quest 지원
     │    ├── HoloLens 지원
     │    └── Magic Leap 지원
     │
     └── 🧠 AI 모델 확장
          ├── 로컬 AI (Edge)
          ├── 커스텀 모델
          └── 다중 AI 조합
```

---

## 📈 성능 최적화 포인트

### **최적화된 영역들**

```
🎯 이미지 처리 최적화:
├── 해상도 조정 (512px 최대)
├── JPEG 품질 최적화 (70%)
├── YUV→RGB 변환 최적화
└── 메모리 풀 재사용

🚀 네트워크 최적화:
├── HTTP/2 연결 재사용  
├── 압축 및 인코딩 최적화
├── 요청 배칭 및 큐잉
└── 오프라인 모드 지원

⚡ UI 렌더링 최적화:
├── Compose 상태 최적화
├── 리컴포지션 최소화
├── LazyLoading 적용
└── 애니메이션 성능 튜닝

🧠 메모리 최적화:
├── 비트맵 리사이클링
├── 캐시 크기 제한
├── GC 압박 최소화
└── 메모리 누수 방지
```

이 아키텍처는 **확장성, 성능, 안정성**을 모두 고려한 설계로, 실제 프로덕션 환경에서 사용 가능한 수준입니다.